<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claty | AI Insight Search Engine</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
  :root {
    --bg-color-light: #F8F9FA; --card-color-light: #FFFFFF;
    --text-primary-light: #202124; --text-secondary-light: #5F6368;
    --border-color-light: #E8EAED; --accent-color: #4A80FF;
    --bg-color-dark: #202124; --card-color-dark: #292A2D;
    --text-primary-dark: #E8EAED; --text-secondary-dark: #969BA1;
    --border-color-dark: #3C4043;
    --gradient-start-light: #4A80FF; --gradient-end-light: #9C6BFF;
    --gradient-start-dark: #8CB4FF; --gradient-end-dark: #D19CFF;
  }

  body { font-family: 'Noto Sans KR', sans-serif; margin: 0; padding: 40px 20px; min-height: 100vh; box-sizing: border-box; background-color: var(--bg-color-light); color: var(--text-primary-light); transition: background-color 0.3s, color 0.3s; }
  body.dark-mode { background-color: var(--bg-color-dark); color: var(--text-primary-dark); }
  body.party-mode { animation: partyBackground 2s ease-in-out infinite; }
  @keyframes partyBackground { 0%, 100% { filter: hue-rotate(0deg); } 50% { filter: hue-rotate(180deg); } }
  body.disco-mode { animation: discoFlash 0.5s ease-in-out infinite; }
  @keyframes discoFlash { 0%, 100% { background-color: #FF0080; } 25% { background-color: #00FF80; } 50% { background-color: #0080FF; } 75% { background-color: #FF8000; } }

  .container { width: 100%; max-width: 800px; margin: 0 auto; }

  .header { text-align: center; margin-bottom: 50px; cursor: pointer; user-select: none; transition: transform 0.2s ease-out; }
  .header:hover { transform: scale(1.02); }
  .header.shake { animation: shake 0.5s ease-in-out; }
  @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px) rotate(-5deg); } 75% { transform: translateX(10px) rotate(5deg); } }

  .logo-container { display: flex; align-items: center; justify-content: center; gap: -5px; transform: translateY(2px); }

  .logo-svg { width: 44px; height: 44px; transition: transform 0.25s ease, filter 0.25s ease; }
  .logo-svg:hover { transform: scale(1.08) rotate(5deg); filter: drop-shadow(0 0 8px rgba(74, 128, 255, 0.5)); }
  .logo-svg.party { animation: logoParty 1s ease-in-out infinite; }
  @keyframes logoParty { 0%, 100% { transform: scale(1) rotate(0deg); } 25% { transform: scale(1.2) rotate(-15deg); } 75% { transform: scale(1.2) rotate(15deg); } }

  h1 { font-weight: 800; font-size: 2.4em; letter-spacing: -0.02em; margin: -5px; color: var(--text-primary-light); }
  body.dark-mode h1 { color: var(--text-primary-dark); }

  .gradient-start { stop-color: var(--gradient-start-light); }
  .gradient-end { stop-color: var(--gradient-end-light); }
  body.dark-mode .gradient-start { stop-color: var(--gradient-start-dark); }
  body.dark-mode .gradient-end { stop-color: var(--gradient-end-dark); }

  .header p { font-size: 1.1em; color: var(--text-secondary-light); margin: 4px 0 0 0; }
  body.dark-mode .header p { color: var(--text-secondary-dark); }

  .search-box { display: flex; position: relative; margin-bottom: 40px; background-color: var(--card-color-light); border: 1px solid var(--border-color-light); border-radius: 28px; box-shadow: 0 1px 6px rgba(32,33,36,.28); transition: all 0.3s ease; }
  .search-box:hover { box-shadow: 0 1px 8px rgba(32,33,36,.35); }
  .search-box:focus-within { box-shadow: 0 2px 12px rgba(74, 128, 255, 0.3); border-color: var(--accent-color); transform: translateY(-2px); }
  body.dark-mode .search-box { background-color: var(--card-color-dark); border-color: var(--border-color-dark); }

  #searchInput { flex-grow: 1; border: none; outline: none; padding: 16px 24px; font-size: 1.05em; background: transparent; color: inherit; }

  #voiceButton { border: none; background: transparent; color: var(--text-secondary-light); padding: 0 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
  body.dark-mode #voiceButton { color: var(--text-secondary-dark); }
  #voiceButton:hover { color: var(--accent-color); transform: scale(1.1); }

  #searchButton { border: none; background: var(--accent-color); color: white; padding: 0 28px; border-radius: 0 28px 28px 0; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; }
  #searchButton:hover { background-color: #3569D6; transform: scale(1.05); }
  #searchButton:hover .material-icons { transform: rotate(90deg); }
  #searchButton .material-icons { transition: transform 0.3s ease; }

  .welcome-section { text-align: center; padding: 40px 20px; border-radius: 16px; background-color: var(--card-color-light); border: 1px solid var(--border-color-light); animation: fadeIn 0.5s ease-out; }
  body.dark-mode .welcome-section { background-color: var(--card-color-dark); border-color: var(--border-color-dark); }

  .welcome-section h2 { margin-top: 0; font-size: 1.5em; }

  .example-tags { margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
  .example-tag { background-color: var(--bg-color-light); border: 1px solid var(--border-color-light); border-radius: 20px; padding: 8px 16px; font-size: 0.9em; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px; opacity: 0; animation: tagFadeIn 0.5s ease-out forwards; }
  .example-tag:nth-child(1) { animation-delay: 0.1s; }
  .example-tag:nth-child(2) { animation-delay: 0.2s; }
  .example-tag:nth-child(3) { animation-delay: 0.3s; }
  @keyframes tagFadeIn { to { opacity: 1; transform: translateY(0); } from { opacity: 0; transform: translateY(10px); } }
  body.dark-mode .example-tag { background-color: var(--card-color-dark); border-color: var(--border-color-dark); }
  .example-tag:hover { border-color: var(--accent-color); color: var(--accent-color); background-color: #E8F0FE; transform: translateY(-3px) scale(1.05); box-shadow: 0 4px 12px rgba(74, 128, 255, 0.2); }
  body.dark-mode .example-tag:hover { background-color: rgba(74, 128, 255, 0.1); }
  .example-tag .material-icons { font-size: 18px; }

  .diagnostic-info { font-size: 0.8em; color: #ffc107; background-color: rgba(255, 193, 7, 0.1); padding: 8px 12px; border-radius: 8px; margin-top: 20px; display: inline-block; border: 1px solid rgba(255, 193, 7, 0.2); }

  .result-card { background-color: var(--card-color-light); border: 1px solid var(--border-color-light); border-radius: 16px; margin-top: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.02), 0 10px 20px rgba(0,0,0,0.05); opacity: 0; transform: translateY(20px); animation: cardSlideIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; overflow: hidden; background-size: cover; background-position: center; }
  @keyframes cardSlideIn { to { opacity: 1; transform: translateY(0); } }
  body.dark-mode .result-card { background-color: var(--card-color-dark); border-color: var(--border-color-dark); }

  .card-content { padding: 30px 40px; background-color: rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px); }
  body.dark-mode .card-content { background-color: rgba(32, 33, 36, 0.3); }

  .result-card.rainbow-background { background: linear-gradient(270deg, #ff2400, #e8b71d, #1de840, #1ddde8, #2b1de8, #dd00f3) !important; background-size: 1400% 1400% !important; animation: rainbow 10s ease infinite, cardSlideIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards !important; color: white !important; border: none !important; }
  @keyframes rainbow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
  .result-card.rainbow-background .card-content { padding: 30px 40px; background-color: transparent !important; backdrop-filter: none !important; }
  .result-card.rainbow-background .summary-content, .result-card.rainbow-background .details-content, .result-card.rainbow-background .section-header, .result-card.rainbow-background .suggested-questions li, .result-card.rainbow-background .related-links a { color: white !important; text-shadow: 0 2px 8px rgba(0,0,0,0.5) !important; }
  .result-card.rainbow-background .divider { background-color: rgba(255, 255, 255, 0.3) !important; }
  .result-card.rainbow-background .insight-box { background-color: rgba(255, 255, 255, 0.15) !important; border-color: rgba(255, 255, 255, 0.3) !important; }
  .result-card.rainbow-background .insight-box h4 { color: rgba(255, 255, 255, 0.9) !important; }
  .result-card.rainbow-background .insight-tag { background-color: rgba(255, 255, 255, 0.2); border-color: rgba(255, 255, 255, 0.4); }

  .summary-content { font-size: 1.2em; line-height: 1.7; font-weight: 500; margin-bottom: 30px; color: var(--text-primary-light); }
  body.dark-mode .summary-content { color: var(--text-primary-dark); }

  .insights-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
  .insight-box { background-color: var(--bg-color-light); border: 1px solid var(--border-color-light); border-radius: 12px; padding: 20px; transition: all 0.3s ease; }
  .insight-box:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
  body.dark-mode .insight-box { background-color: var(--card-color-dark); border-color: var(--border-color-dark); }
  .insight-box h4 { margin: 0 0 12px 0; font-size: 0.9em; font-weight: 500; color: var(--text-secondary-light); }
  body.dark-mode .insight-box h4 { color: var(--text-secondary-dark); }

  .insight-tags { display: flex; flex-wrap: wrap; gap: 8px; }
  .insight-tag { background-color: var(--card-color-light); border: 1px solid var(--border-color-light); border-radius: 20px; padding: 5px 12px; font-size: 0.9em; cursor: pointer; transition: all 0.2s ease; }
  body.dark-mode .insight-tag { background-color: var(--bg-color-dark); border-color: var(--border-color-dark); }
  .insight-tag:hover { background-color: var(--accent-color); color: white; border-color: var(--accent-color); transform: translateY(-2px); }

  .divider { border: none; height: 1px; background-color: var(--border-color-light); margin: 30px 0; }
  body.dark-mode .divider { background-color: var(--border-color-dark); }

  .section-header { font-size: 1.1em; font-weight: 700; margin-bottom: 16px; color: var(--text-primary-light); }
  body.dark-mode .section-header { color: var(--text-primary-dark); }

  .details-content { white-space: pre-wrap; line-height: 1.8; color: var(--text-primary-light); }
  body.dark-mode .details-content { color: var(--text-primary-dark); }

  .suggested-questions ul, .related-links ul { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px; }
  .suggested-questions li { padding: 12px 16px; cursor: pointer; border-radius: 8px; font-weight: 500; transition: all 0.2s; }
  .suggested-questions li:hover { background-color: var(--bg-color-light); transform: translateX(5px); }
  body.dark-mode .suggested-questions li:hover { background-color: var(--card-color-dark); }

  .related-links a { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 8px; text-decoration: none; color: inherit; font-weight: 500; transition: all 0.2s; }
  .related-links a:hover { background-color: var(--bg-color-light); transform: translateX(5px); }
  body.dark-mode .related-links a:hover { background-color: var(--card-color-dark); }
  .related-links .material-icons { font-size: 20px; color: var(--text-secondary-light); transition: transform 0.2s; }
  .related-links a:hover .material-icons { transform: translateX(3px); }
  body.dark-mode .related-links .material-icons { color: var(--text-secondary-dark); }

  .loader { margin: 50px auto; width: 60px; height: 60px; position: relative; }
  .loader::before, .loader::after { content: ''; position: absolute; border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
  .loader::before { width: 60px; height: 60px; background: linear-gradient(45deg, var(--gradient-start-light), var(--gradient-end-light)); opacity: 0.6; }
  .loader::after { width: 40px; height: 40px; top: 10px; left: 10px; background: linear-gradient(45deg, var(--gradient-end-light), var(--gradient-start-light)); animation-delay: 0.5s; }
  @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.6; } 50% { transform: scale(1.3); opacity: 0.2; } }

  .top-controls { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; z-index: 1000; }

  .control-button { cursor: pointer; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; background-color: var(--card-color-light); color: var(--text-primary-light); border: 1px solid var(--border-color-light); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  body.dark-mode .control-button { background-color: var(--card-color-dark); color: var(--text-primary-dark); border-color: var(--border-color-dark); }
  .control-button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); background-color: var(--accent-color); color: white; }

  .language-selector-wrapper, .persona-selector-wrapper { position: relative; }

  .language-button, .persona-button { cursor: pointer; min-width: 80px; height: 40px; border-radius: 20px; display: flex; align-items: center; justify-content: center; gap: 6px; padding: 0 16px; transition: all 0.3s ease; background-color: var(--card-color-light); color: var(--text-primary-light); border: 1px solid var(--border-color-light); box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-size: 0.9em; font-weight: 500; }
  body.dark-mode .language-button, body.dark-mode .persona-button { background-color: var(--card-color-dark); color: var(--text-primary-dark); border-color: var(--border-color-dark); }
  .language-button:hover, .persona-button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-color: var(--accent-color); }

  .language-dropdown, .persona-dropdown { position: absolute; top: 50px; right: 0; min-width: 250px; max-height: 400px; overflow-y: auto; background-color: var(--card-color-light); border: 1px solid var(--border-color-light); border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); opacity: 0; transform: translateY(-10px); pointer-events: none; transition: all 0.3s ease; z-index: 1001; }
  body.dark-mode .language-dropdown, body.dark-mode .persona-dropdown { background-color: var(--card-color-dark); border-color: var(--border-color-dark); box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
  .language-dropdown.active, .persona-dropdown.active { opacity: 1; transform: translateY(0); pointer-events: all; }

  .language-dropdown::-webkit-scrollbar, .persona-dropdown::-webkit-scrollbar { width: 8px; }
  .language-dropdown::-webkit-scrollbar-track, .persona-dropdown::-webkit-scrollbar-track { background: transparent; }
  .language-dropdown::-webkit-scrollbar-thumb, .persona-dropdown::-webkit-scrollbar-thumb { background: var(--border-color-light); border-radius: 4px; }
  body.dark-mode .language-dropdown::-webkit-scrollbar-thumb, body.dark-mode .persona-dropdown::-webkit-scrollbar-thumb { background: var(--border-color-dark); }

  .language-option, .persona-option { padding: 12px 16px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 10px; font-size: 0.9em; }
  .language-option:first-child, .persona-option:first-child { border-radius: 16px 16px 0 0; }
  .language-option:last-child, .persona-option:last-child { border-radius: 0 0 16px 16px; }
  .language-option:hover, .persona-option:hover { background-color: var(--bg-color-light); }
  body.dark-mode .language-option:hover, body.dark-mode .persona-option:hover { background-color: var(--bg-color-dark); }
  .language-option.active, .persona-option.active { background-color: var(--accent-color); color: white; font-weight: 500; }
  .language-option.active:hover, .persona-option.active:hover { background-color: var(--accent-color); }

  .language-option .flag { font-size: 20px; }
  .persona-option .material-icons { font-size: 20px; }

  .confetti { position: fixed; width: 10px; height: 10px; background: #f00; top: -10px; z-index: 9999; pointer-events: none; animation: confettiFall 3s linear forwards; }
  @keyframes confettiFall { to { transform: translateY(110vh) rotate(720deg); opacity: 0; } }

  .konami-game { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.95); padding: 40px; border-radius: 20px; z-index: 10000; display: none; color: white; text-align: center; }
  .konami-game.active { display: block; animation: gameAppear 0.5s ease-out; }
  @keyframes gameAppear { from { transform: translate(-50%, -50%) scale(0); } to { transform: translate(-50%, -50%) scale(1); } }

  .error-card { border-color: #ff4444; }
  .error-card h2 { color: #ff4444; margin-top: 0; }

  .voice-listening-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(5px); }
  .voice-listening-overlay.active { display: flex; }
  .mic-icon-large { font-size: 80px; color: white; animation: micPulse 1.5s infinite; }
  @keyframes micPulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.2); opacity: 0.7; } 100% { transform: scale(1); opacity: 1; } }

  @media (max-width: 768px) {
    .top-controls { flex-direction: column; align-items: flex-end; gap: 12px; }
    .language-dropdown, .persona-dropdown { min-width: 220px; max-height: 300px; }
  }
  </style>
</head>
<body>
  <div class="top-controls">
    <div class="persona-selector-wrapper">
      <div class="persona-button" onclick="togglePersonaDropdown()">
        <span id="currentPersonaIcon" class="material-icons">account_circle</span>
        <span id="currentPersonaName">ê¸°ë³¸</span>
      </div>
      <div class="persona-dropdown" id="personaDropdown">
        <div class="persona-option active" onclick="selectPersona('default', 'account_circle', 'ê¸°ë³¸')">
          <span class="material-icons">account_circle</span>
          <span>ê¸°ë³¸ ë¶„ì„ê°€</span>
        </div>
        <div class="persona-option" onclick="selectPersona('child', 'child_care', 'ì•„ì´')">
          <span class="material-icons">child_care</span>
          <span>5ì„¸ ì•„ì´</span>
        </div>
        <div class="persona-option" onclick="selectPersona('scientist', 'science', 'ê³¼í•™ì')">
          <span class="material-icons">science</span>
          <span>ëƒ‰ì² í•œ ê³¼í•™ì</span>
        </div>
        <div class="persona-option" onclick="selectPersona('alien', 'rocket_launch', 'ì™¸ê³„ì¸')">
          <span class="material-icons">rocket_launch</span>
          <span>ì•ˆë“œë¡œë©”ë‹¤ ì™¸ê³„ì¸</span>
        </div>
        <div class="persona-option" onclick="selectPersona('conspiracy', 'policy', 'ìŒëª¨ë¡ ì')">
          <span class="material-icons">policy</span>
          <span>ìˆ˜ìƒí•œ ìŒëª¨ë¡ ì</span>
        </div>
        <div class="persona-option" onclick="selectPersona('comedian', 'theater_comedy', 'ì½”ë¯¸ë””ì–¸')">
          <span class="material-icons">theater_comedy</span>
          <span>ìœ ì¾Œí•œ ì½”ë¯¸ë””ì–¸</span>
        </div>
        <div class="persona-option" onclick="selectPersona('journalist', 'article', 'ê¸°ì')">
          <span class="material-icons">article</span>
          <span>í”„ë¡œ ê¸°ì</span>
        </div>
      </div>
    </div>
    <div class="language-selector-wrapper">
      <div class="language-button" onclick="toggleLanguageDropdown()">
        <span id="currentLanguageFlag">ğŸ‡°ğŸ‡·</span>
        <span id="currentLanguageCode">KO</span>
        <span class="material-icons" style="font-size: 18px;">expand_more</span>
      </div>
      <div class="language-dropdown" id="languageDropdown">
        <div class="language-option active" onclick="selectLanguage('ko', 'ğŸ‡°ğŸ‡·', 'KO')"><span class="flag">ğŸ‡°ğŸ‡·</span><span>í•œêµ­ì–´ (Korean)</span></div>
        <div class="language-option" onclick="selectLanguage('en', 'ğŸ‡ºğŸ‡¸', 'EN')"><span class="flag">ğŸ‡ºğŸ‡¸</span><span>English (US)</span></div>
        <div class="language-option" onclick="selectLanguage('ja', 'ğŸ‡¯ğŸ‡µ', 'JA')"><span class="flag">ğŸ‡¯ğŸ‡µ</span><span>æ—¥æœ¬èª (Japanese)</span></div>
        <div class="language-option" onclick="selectLanguage('zh-CN', 'ğŸ‡¨ğŸ‡³', 'CN')"><span class="flag">ğŸ‡¨ğŸ‡³</span><span>ä¸­æ–‡ç®€ä½“ (Chinese Simplified)</span></div>
        <div class="language-option" onclick="selectLanguage('zh-TW', 'ğŸ‡¹ğŸ‡¼', 'TW')"><span class="flag">ğŸ‡¹ğŸ‡¼</span><span>ä¸­æ–‡ç¹é«” (Chinese Traditional)</span></div>
        <div class="language-option" onclick="selectLanguage('es', 'ğŸ‡ªğŸ‡¸', 'ES')"><span class="flag">ğŸ‡ªğŸ‡¸</span><span>EspaÃ±ol (Spanish)</span></div>
        <div class="language-option" onclick="selectLanguage('fr', 'ğŸ‡«ğŸ‡·', 'FR')"><span class="flag">ğŸ‡«ğŸ‡·</span><span>FranÃ§ais (French)</span></div>
        <div class="language-option" onclick="selectLanguage('de', 'ğŸ‡©ğŸ‡ª', 'DE')"><span class="flag">ğŸ‡©ğŸ‡ª</span><span>Deutsch (German)</span></div>
        <div class="language-option" onclick="selectLanguage('ru', 'ğŸ‡·ğŸ‡º', 'RU')"><span class="flag">ğŸ‡·ğŸ‡º</span><span>Ğ ÑƒÑÑĞºĞ¸Ğ¹ (Russian)</span></div>
        <div class="language-option" onclick="selectLanguage('ar', 'ğŸ‡¸ğŸ‡¦', 'AR')"><span class="flag">ğŸ‡¸ğŸ‡¦</span><span>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)</span></div>
        <div class="language-option" onclick="selectLanguage('hi', 'ğŸ‡®ğŸ‡³', 'HI')"><span class="flag">ğŸ‡®ğŸ‡³</span><span>à¤¹à¤¿à¤¨à¥à¤¦à¥€ (Hindi)</span></div>
        <div class="language-option" onclick="selectLanguage('pt', 'ğŸ‡§ğŸ‡·', 'PT')"><span class="flag">ğŸ‡§ğŸ‡·</span><span>PortuguÃªs (Portuguese)</span></div>
        <div class="language-option" onclick="selectLanguage('it', 'ğŸ‡®ğŸ‡¹', 'IT')"><span class="flag">ğŸ‡®ğŸ‡¹</span><span>Italiano (Italian)</span></div>
        <div class="language-option" onclick="selectLanguage('nl', 'ğŸ‡³ğŸ‡±', 'NL')"><span class="flag">ğŸ‡³ğŸ‡±</span><span>Nederlands (Dutch)</span></div>
        <div class="language-option" onclick="selectLanguage('tr', 'ğŸ‡¹ğŸ‡·', 'TR')"><span class="flag">ğŸ‡¹ğŸ‡·</span><span>TÃ¼rkÃ§e (Turkish)</span></div>
      </div>
    </div>
    <button class="control-button" id="darkModeToggle" onclick="toggleDarkMode()" title="Dark Mode Toggle">
      <span class="material-icons">dark_mode</span>
    </button>
  </div>

  <div class="voice-listening-overlay" id="voiceOverlay">
    <span class="material-icons mic-icon-large">mic</span>
  </div>

  <div class="konami-game" id="konamiGame">
    <h2>ğŸ® You found the secret! ğŸ®</h2>
    <p>Congratulations! You're a true explorer!</p>
    <p style="font-size: 2em; margin: 20px 0;">ğŸ†âœ¨ğŸ‰</p>
    <button onclick="closeKonamiGame()" style="padding: 10px 20px; font-size: 1em; cursor: pointer; border: none; background: var(--accent-color); color: white; border-radius: 8px;">Close</button>
  </div>

  <div class="container">
    <header class="header" onclick="logoClick()" id="mainHeader">
      <div class="logo-container">
        <svg class="logo-svg" id="mainLogo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
          <path class="shape" d="M75,20 A30,30 0 1 0 75,80 M75,80 A40,40 0 1 1 75,20" fill="none" stroke="url(#clatyGradient)" stroke-width="10" stroke-linecap="round"/>
          <circle class="shape" cx="60" cy="50" r="8" fill="url(#clatyGradient)"/>
          <defs>
            <linearGradient id="clatyGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop class="gradient-start" offset="0%"/>
              <stop class="gradient-end" offset="100%"/>
            </linearGradient>
          </defs>
        </svg>
        <h1>laty</h1>
      </div>
      <p id="subtitle">AI ì¸ì‚¬ì´íŠ¸ ì—”ì§„</p>
    </header>

    <main>
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="ì•Œê³  ì‹¶ì€ ì£¼ì œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ˆì´í¬ë¥¼ ëˆŒëŸ¬ ë§í•´ë³´ì„¸ìš”...">
        <button type="button" id="voiceButton" title="ìŒì„± ê²€ìƒ‰">
          <span class="material-icons">mic</span>
        </button>
        <button type="button" id="searchButton" title="ê²€ìƒ‰">
          <span class="material-icons">search</span>
        </button>
      </div>

      <section id="welcomeSection">
        <div class="welcome-section">
          <h2 id="trendTitle">ì˜¤ëŠ˜ì˜ íŠ¸ë Œë“œ</h2>
          <p id="trendDesc">AIê°€ ë¶„ì„í•œ ì§€ê¸ˆ ê°€ì¥ ì£¼ëª©í•  ë§Œí•œ ì£¼ì œì…ë‹ˆë‹¤.</p>
          <div class="example-tags" id="exampleTags"></div>
          <div id="diagnosticContainer"></div>
        </div>
      </section>

      <section id="resultSection"></section>
    </main>
  </div>

  <script>
    const translations = {
      ko: { subtitle: "AI ì¸ì‚¬ì´íŠ¸ ì—”ì§„", searchPlaceholder: "ì•Œê³  ì‹¶ì€ ì£¼ì œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë§ˆì´í¬ë¥¼ ëˆŒëŸ¬ ë§í•´ë³´ì„¸ìš”...", trendTitle: "ì˜¤ëŠ˜ì˜ íŠ¸ë Œë“œ", trendDesc: "AIê°€ ë¶„ì„í•œ ì§€ê¸ˆ ê°€ì¥ ì£¼ëª©í•  ë§Œí•œ ì£¼ì œì…ë‹ˆë‹¤.", detailsHeader: "ìƒì„¸ì„¤ëª…", questionsHeader: "ì¶”ê°€ ì§ˆë¬¸", linksHeader: "ê´€ë ¨ ë§í¬", keywordsLabel: "í•µì‹¬ í‚¤ì›Œë“œ", peopleLabel: "ì£¼ìš” ì¸ë¬¼/ê¸°ê´€", datesLabel: "ê´€ë ¨ ë‚ ì§œ/ì‚¬ê±´" },
      en: { subtitle: "AI Insight Engine", searchPlaceholder: "Enter a topic or use the mic to speak...", trendTitle: "Today's Trends", trendDesc: "The most noteworthy topics of the day, analyzed by AI.", detailsHeader: "Details", questionsHeader: "Follow-up Questions", linksHeader: "Related Links", keywordsLabel: "Keywords", peopleLabel: "Key People/Organizations", datesLabel: "Related Dates/Events" },
      ja: { subtitle: "AIã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚¨ãƒ³ã‚¸ãƒ³", searchPlaceholder: "çŸ¥ã‚ŠãŸã„ãƒˆãƒ”ãƒƒã‚¯ã‚’å…¥åŠ›ã™ã‚‹ã‹ã€ãƒã‚¤ã‚¯ã‚’ä½¿ã£ã¦è©±ã—ã¦ãã ã•ã„...", trendTitle: "ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ³ãƒ‰", trendDesc: "AIãŒåˆ†æã—ãŸã€ä»Šæœ€ã‚‚æ³¨ç›®ã™ã¹ããƒˆãƒ”ãƒƒã‚¯ã§ã™ã€‚", detailsHeader: "è©³ç´°èª¬æ˜", questionsHeader: "è¿½åŠ ã®è³ªå•", linksHeader: "é–¢é€£ãƒªãƒ³ã‚¯", keywordsLabel: "ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰", peopleLabel: "ä¸»è¦äººç‰©ãƒ»çµ„ç¹”", datesLabel: "é–¢é€£æ—¥ä»˜ãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ" },
      'zh-CN': { subtitle: "AIæ´å¯Ÿå¼•æ“", searchPlaceholder: "è¾“å…¥æ‚¨æƒ³çŸ¥é“çš„ä¸»é¢˜ï¼Œæˆ–ä½¿ç”¨éº¦å…‹é£...", trendTitle: "ä»Šæ—¥çƒ­ç‚¹", trendDesc: "ç”±AIåˆ†æçš„å½“å‰æœ€å—å…³æ³¨çš„ä¸»é¢˜ã€‚", detailsHeader: "è¯¦ç»†è¯´æ˜", questionsHeader: "è¿½åŠ é—®é¢˜", linksHeader: "ç›¸å…³é“¾æ¥", keywordsLabel: "å…³é”®è¯", peopleLabel: "ä¸»è¦äººç‰©/æœºæ„", datesLabel: "ç›¸å…³æ—¥æœŸ/äº‹ä»¶" },
      'zh-TW': { subtitle: "AIæ´å¯Ÿå¼•æ“", searchPlaceholder: "è¼¸å…¥æ‚¨æƒ³çŸ¥é“çš„ä¸»é¡Œï¼Œæˆ–ä½¿ç”¨éº¥å…‹é¢¨...", trendTitle: "ä»Šæ—¥ç†±é»", trendDesc: "ç”±AIåˆ†æçš„ç•¶å‰æœ€å—é—œæ³¨çš„ä¸»é¡Œã€‚", detailsHeader: "è©³ç´°èªªæ˜", questionsHeader: "è¿½åŠ å•é¡Œ", linksHeader: "ç›¸é—œéˆæ¥", keywordsLabel: "é—œéµè©", peopleLabel: "ä¸»è¦äººç‰©/æ©Ÿæ§‹", datesLabel: "ç›¸é—œæ—¥æœŸ/äº‹ä»¶" },
      es: { subtitle: "Motor de Insight de IA", searchPlaceholder: "Ingrese un tema o use el micrÃ³fono para hablar...", trendTitle: "Tendencias de Hoy", trendDesc: "Los temas mÃ¡s notables del dÃ­a, analizados por IA.", detailsHeader: "Detalles", questionsHeader: "Preguntas Adicionales", linksHeader: "Enlaces Relacionados", keywordsLabel: "Palabras Clave", peopleLabel: "Personas/Organizaciones Clave", datesLabel: "Fechas/Eventos Relacionados" },
      fr: { subtitle: "Moteur d'Insight IA", searchPlaceholder: "Entrez un sujet ou utilisez le micro pour parler...", trendTitle: "Tendances du Jour", trendDesc: "Les sujets les plus remarquables du jour, analysÃ©s par l'IA.", detailsHeader: "DÃ©tails", questionsHeader: "Questions de suivi", linksHeader: "Liens Connexes", keywordsLabel: "Mots-clÃ©s", peopleLabel: "Personnes/Organisations ClÃ©s", datesLabel: "Dates/Ã‰vÃ©nements Connexes" },
      de: { subtitle: "KI-Insight-Engine", searchPlaceholder: "Geben Sie ein Thema ein oder sprechen Sie Ã¼ber das Mikrofon...", trendTitle: "Heutige Trends", trendDesc: "Die bemerkenswertesten Themen des Tages, von KI analysiert.", detailsHeader: "Details", questionsHeader: "Weitere Fragen", linksHeader: "Ã„hnliche Links", keywordsLabel: "SchlÃ¼sselwÃ¶rter", peopleLabel: "SchlÃ¼sselpersonen/Organisationen", datesLabel: "Relevante Daten/Ereignisse" },
      ru: { subtitle: "Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° ĞŸĞ¾Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ğ˜Ğ˜", searchPlaceholder: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚ĞµĞ¼Ñƒ Ğ¸Ğ»Ğ¸ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ğ² Ğ¼Ğ¸ĞºÑ€Ğ¾Ñ„Ğ¾Ğ½...", trendTitle: "Ğ¢Ñ€ĞµĞ½Ğ´Ñ‹ Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ", trendDesc: "Ğ¡Ğ°Ğ¼Ñ‹Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ½Ñ‹Ğµ Ñ‚ĞµĞ¼Ñ‹ Ğ´Ğ½Ñ, Ğ¿Ñ€Ğ¾Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ˜Ğ˜.", detailsHeader: "ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸", questionsHeader: "Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹", linksHeader: "Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ ÑÑÑ‹Ğ»ĞºĞ¸", keywordsLabel: "ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°", peopleLabel: "ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ»Ğ¸Ñ†Ğ°/Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸", datesLabel: "Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ñ‚Ñ‹/ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ" },
      ar: { subtitle: "Ù…Ø­Ø±Ùƒ Ø±Ø¤Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", searchPlaceholder: "Ø£Ø¯Ø®Ù„ Ù…ÙˆØ¶ÙˆØ¹Ù‹Ø§ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù„Ù„ØªØ­Ø¯Ø«...", trendTitle: "Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„ÙŠÙˆÙ…", trendDesc: "Ø£Ø¨Ø±Ø² Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªÙŠ Ø­Ù„Ù„Ù‡Ø§ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.", detailsHeader: "Ø§Ù„ØªÙØ§ØµÙŠÙ„", questionsHeader: "Ø£Ø³Ø¦Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ©", linksHeader: "Ø±ÙˆØ§Ø¨Ø· Ø°Ø§Øª ØµÙ„Ø©", keywordsLabel: "Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", peopleLabel: "Ø§Ù„Ø£Ø´Ø®Ø§Øµ/Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", datesLabel: "ØªÙˆØ§Ø±ÙŠØ®/Ø£Ø­Ø¯Ø§Ø« Ø°Ø§Øª ØµÙ„Ø©" },
      hi: { subtitle: "à¤à¤†à¤ˆ à¤‡à¤¨à¤¸à¤¾à¤‡à¤Ÿ à¤‡à¤‚à¤œà¤¨", searchPlaceholder: "à¤•à¥‹à¤ˆ à¤µà¤¿à¤·à¤¯ à¤¦à¤°à¥à¤œ à¤•à¤°à¥‡à¤‚ à¤¯à¤¾ à¤¬à¥‹à¤²à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ à¤®à¤¾à¤‡à¤• à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¥‡à¤‚...", trendTitle: "à¤†à¤œ à¤•à¥‡ à¤Ÿà¥à¤°à¥‡à¤‚à¤¡à¥à¤¸", trendDesc: "à¤à¤†à¤ˆ à¤¦à¥à¤µà¤¾à¤°à¤¾ à¤µà¤¿à¤¶à¥à¤²à¥‡à¤·à¤¿à¤¤ à¤¦à¤¿à¤¨ à¤•à¥‡ à¤¸à¤¬à¤¸à¥‡ à¤‰à¤²à¥à¤²à¥‡à¤–à¤¨à¥€à¤¯ à¤µà¤¿à¤·à¤¯à¥¤", detailsHeader: "à¤µà¤¿à¤µà¤°à¤£", questionsHeader: "à¤…à¤¤à¤¿à¤°à¤¿à¤•à¥à¤¤ à¤ªà¥à¤°à¤¶à¥à¤¨", linksHeader: "à¤¸à¤‚à¤¬à¤‚à¤§à¤¿à¤¤ à¤²à¤¿à¤‚à¤•", keywordsLabel: "à¤•à¥€à¤µà¤°à¥à¤¡", peopleLabel: "à¤ªà¥à¤°à¤®à¥à¤– à¤²à¥‹à¤—/à¤¸à¤‚à¤—à¤ à¤¨", datesLabel: "à¤¸à¤‚à¤¬à¤‚à¤§à¤¿à¤¤ à¤¤à¤¿à¤¥à¤¿à¤¯à¤¾à¤‚/à¤˜à¤Ÿà¤¨à¤¾à¤à¤‚" },
      pt: { subtitle: "Mecanismo de Insight de IA", searchPlaceholder: "Digite um tÃ³pico ou use o microfone para falar...", trendTitle: "TendÃªncias de Hoje", trendDesc: "Os tÃ³picos mais notÃ¡veis do dia, analisados por IA.", detailsHeader: "Detalhes", questionsHeader: "Perguntas Adicionais", linksHeader: "Links Relacionados", keywordsLabel: "Palavras-chave", peopleLabel: "Pessoas/OrganizaÃ§Ãµes Chave", datesLabel: "Datas/Eventos Relacionados" },
      it: { subtitle: "Motore di Insight AI", searchPlaceholder: "Inserisci un argomento o usa il microfono per parlare...", trendTitle: "Tendenze di Oggi", trendDesc: "Gli argomenti piÃ¹ notevoli del giorno, analizzati dall'IA.", detailsHeader: "Dettagli", questionsHeader: "Domande Aggiuntive", linksHeader: "Link Correlati", keywordsLabel: "Parole Chiave", peopleLabel: "Persone/Organizzazioni Chiave", datesLabel: "Date/Eventi Correlati" },
      nl: { subtitle: "AI Inzicht Engine", searchPlaceholder: "Voer een onderwerp in of gebruik de microfoon om te spreken...", trendTitle: "Trends van Vandaag", trendDesc: "De meest opmerkelijke onderwerpen van de dag, geanalyseerd door AI.", detailsHeader: "Details", questionsHeader: "Aanvullende Vragen", linksHeader: "Gerelateerde Links", keywordsLabel: "Trefwoorden", peopleLabel: "Sleutelfiguren/Organisaties", datesLabel: "Gerelateerde Data/Evenementen" },
      tr: { subtitle: "AI Ä°Ã§gÃ¶rÃ¼ Motoru", searchPlaceholder: "Bir konu girin veya konuÅŸmak iÃ§in mikrofonu kullanÄ±n...", trendTitle: "BugÃ¼nÃ¼n Trendleri", trendDesc: "Yapay zeka tarafÄ±ndan analiz edilen gÃ¼nÃ¼n en dikkat Ã§ekici konularÄ±.", detailsHeader: "Detaylar", questionsHeader: "Ek Sorular", linksHeader: "Ä°lgili BaÄŸlantÄ±lar", keywordsLabel: "Anahtar Kelimeler", peopleLabel: "Kilit KiÅŸiler/KuruluÅŸlar", datesLabel: "Ä°lgili Tarihler/Olaylar" }
    };

    let currentLanguage = 'ko';
    let currentPersona = 'default';
    let currentTranslations = translations.ko;
    let logoClickCount = 0;
    let logoClickTimer = null;
    let darkModeToggleCount = 0;
    let trendKeywordsOriginal = [];
    
    async function callApi(endpoint, data) {
        try {
            const response = await fetch(endpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            return await response.json();
        } catch (error) {
            console.error('API Error:', error);
            return { error: 'ì„œë²„ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' };
        }
    }
    
    function logoClick() {
      logoClickCount++;
      if (logoClickCount === 5) {
        clearTimeout(logoClickTimer);
        triggerPartyMode();
        logoClickCount = 0;
        return;
      }
      clearTimeout(logoClickTimer);
      logoClickTimer = setTimeout(() => {
        resetToHome();
        logoClickCount = 0;
      }, 300);
    }

    function triggerPartyMode() {
      document.body.classList.add('party-mode');
      document.getElementById('mainLogo').classList.add('party');
      document.getElementById('mainHeader').classList.add('shake');
      for (let i = 0; i < 50; i++) { setTimeout(() => createConfetti(), i * 30); }
      setTimeout(() => {
        document.body.classList.remove('party-mode');
        document.getElementById('mainLogo').classList.remove('party');
        document.getElementById('mainHeader').classList.remove('shake');
      }, 3000);
    }

    function createConfetti() {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
      confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
      document.body.appendChild(confetti);
      setTimeout(() => confetti.remove(), 3000);
    }

    function toggleDarkMode(){
      darkModeToggleCount++;
      if (darkModeToggleCount === 7) {
        triggerDiscoMode();
        darkModeToggleCount = 0;
        return;
      }
      document.body.classList.toggle('dark-mode');
      const dark = document.body.classList.contains('dark-mode');
      try { localStorage.setItem('darkMode', dark ? 'enabled' : 'disabled'); } catch(e){}
      document.querySelector('#darkModeToggle .material-icons').textContent = dark ? 'light_mode' : 'dark_mode';
      setTimeout(() => { darkModeToggleCount = 0; }, 3000);
    }

    function triggerDiscoMode() {
      document.body.classList.add('disco-mode');
      setTimeout(() => {
        document.body.classList.remove('disco-mode');
      }, 3000);
    }

    function checkKonamiSearch(query) {
      if (query.toLowerCase() === 'konami') {
        document.getElementById('konamiGame').classList.add('active');
        return true;
      }
      return false;
    }

    function closeKonamiGame() {
      document.getElementById('konamiGame').classList.remove('active');
    }

    function toggleLanguageDropdown() {
      document.getElementById('languageDropdown').classList.toggle('active');
    }

    function togglePersonaDropdown() {
      document.getElementById('personaDropdown').classList.toggle('active');
    }

    document.addEventListener('click', function(e) {
      const langWrapper = document.querySelector('.language-selector-wrapper');
      if (langWrapper && !langWrapper.contains(e.target)) {
        document.getElementById('languageDropdown').classList.remove('active');
      }
      const personaWrapper = document.querySelector('.persona-selector-wrapper');
      if (personaWrapper && !personaWrapper.contains(e.target)) {
        document.getElementById('personaDropdown').classList.remove('active');
      }
    });

    function selectLanguage(lang, flag, code) {
      currentLanguage = lang;
      currentTranslations = translations[lang] || translations.ko;
      document.getElementById('currentLanguageFlag').textContent = flag;
      document.getElementById('currentLanguageCode').textContent = code;
      document.querySelectorAll('.language-option').forEach(opt => opt.classList.remove('active'));
      event.currentTarget.classList.add('active');
      document.getElementById('languageDropdown').classList.remove('active');
      document.documentElement.lang = lang;
      
      document.getElementById('subtitle').textContent = currentTranslations.subtitle;
      document.getElementById('searchInput').placeholder = currentTranslations.searchPlaceholder;
      document.getElementById('trendTitle').textContent = currentTranslations.trendTitle;
      document.getElementById('trendDesc').textContent = currentTranslations.trendDesc;
      
      translateTrendKeywords();
      try { 
        localStorage.setItem('clatyLanguage', lang);
        localStorage.setItem('clatyLanguageFlag', flag);
        localStorage.setItem('clatyLanguageCode', code);
      } catch(e) {}
      
      const query = searchInput.value.trim();
      if (query && resultSection.innerHTML && !resultSection.innerHTML.includes('loader')) {
        performSearch();
      }
    }

    function selectPersona(persona, icon, name) {
      currentPersona = persona;
      document.getElementById('currentPersonaIcon').textContent = icon;
      document.getElementById('currentPersonaName').textContent = name;
      document.querySelectorAll('.persona-option').forEach(opt => opt.classList.remove('active'));
      event.currentTarget.classList.add('active');
      document.getElementById('personaDropdown').classList.remove('active');
      
      const query = searchInput.value.trim();
      if (query && resultSection.innerHTML && !resultSection.innerHTML.includes('loader')) {
        performSearch();
      }
    }

    function translateTrendKeywords() {
        if (currentLanguage === 'ko' || trendKeywordsOriginal.length === 0) {
            renderInitialTags({ issues: trendKeywordsOriginal });
            return;
        }
        exampleTagsContainer.innerHTML = `<div style="color: var(--text-secondary-light); font-size: 0.9em;">Translating...</div>`;
        
        // ë³€ê²½ëœ ë¶€ë¶„: fetch ì‚¬ìš©
        callApi('/api/translate_trends', { lang: currentLanguage })
            .then(renderInitialTags)
            .catch(error => renderInitialTags({ issues: trendKeywordsOriginal }));
    }

    let initialData = {};
    try {
      initialData = JSON.parse('<?= initialData ?>' || '{}');
    } catch(e) {
      console.error("initialData parsing error:", e);
    }

    const searchInput = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const welcomeSection = document.getElementById('welcomeSection');
    const resultSection = document.getElementById('resultSection');
    const exampleTagsContainer = document.getElementById('exampleTags');
    const diagnosticContainer = document.getElementById('diagnosticContainer');
    const voiceOverlay = document.getElementById('voiceOverlay');

    function renderInitialTags(data){
      exampleTagsContainer.innerHTML = '';
      diagnosticContainer.innerHTML = '';
      const issues = (data && data.issues) ? data.issues : [];
      const diagnostic = data && data.diagnostic ? data.diagnostic : null;
      
      if (currentLanguage === 'ko' && issues.length > 0) {
        trendKeywordsOriginal = issues;
      }
      
      if (issues.length > 0) {
        const icons = ['trending_up', 'whatshot', 'star'];
        issues.forEach((item, index) => {
          const div = document.createElement('div');
          div.className = 'example-tag';
          const icon = document.createElement('span');
          icon.className = 'material-icons';
          icon.textContent = icons[index % 3];
          div.appendChild(icon);
          const text = document.createElement('span');
          text.textContent = item.query || item.display || '';
          div.appendChild(text);
          div.onclick = () => research(item.query || item.display || '');
          exampleTagsContainer.appendChild(div);
        });
      }
      if (diagnostic) {
        const d = document.createElement('div');
        d.className = 'diagnostic-info';
        d.textContent = diagnostic;
        diagnosticContainer.appendChild(d);
      }
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition = null;
    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      document.getElementById('voiceButton').addEventListener('click', startSpeechRecognition);
      recognition.onresult = (event) => {
        searchInput.value = event.results[0][0].transcript || '';
        stopSpeechRecognition();
        performSearch();
      };
      recognition.onspeechend = stopSpeechRecognition;
      recognition.onerror = (ev) => { console.error("Voice recognition error:", ev); stopSpeechRecognition(); };
    } else {
      document.getElementById('voiceButton').style.display = 'none';
    }

    function startSpeechRecognition(){
      if (!recognition) return;
      const langMap = { 'ko': 'ko-KR', 'en': 'en-US', 'ja': 'ja-JP', 'zh-CN': 'zh-CN', 'zh-TW': 'zh-TW', 'es': 'es-ES', 'fr': 'fr-FR', 'de': 'de-DE', 'ru': 'ru-RU', 'ar': 'ar-SA', 'hi': 'hi-IN', 'pt': 'pt-BR', 'it': 'it-IT', 'nl': 'nl-NL', 'tr': 'tr-TR' };
      recognition.lang = langMap[currentLanguage] || 'ko-KR';
      voiceOverlay.classList.add('active');
      try { recognition.start(); } catch(e) { console.warn(e); voiceOverlay.classList.remove('active'); }
    }

    function stopSpeechRecognition(){
      voiceOverlay.classList.remove('active');
      try { recognition && recognition.stop(); } catch(e){}
    }

    searchButton.addEventListener('click', performSearch);
    searchInput.addEventListener('keyup', (ev) => { if (ev.key === 'Enter') performSearch(); });

    function handleSuccess(response) { displayResult(response); }
    function handleError(err) { displayError(err); }

    function performSearch(){
        const query = searchInput.value.trim();
        if (!query) return;
        if (checkKonamiSearch(query)) return;
        
        console.log(`ğŸ” Searching for: "${query}" (Persona: ${currentPersona}, Lang: ${currentLanguage})`);
        welcomeSection.style.display = 'none';
        resultSection.innerHTML = '<div class="loader"></div>';
        
        // ë³€ê²½ëœ ë¶€ë¶„: Python ì„œë²„ë¡œ ìš”ì²­
        callApi('/api/search', { 
            query: query, 
            persona: currentPersona, 
            lang: currentLanguage 
        }).then(handleSuccess).catch(handleError);
    }

    function resetToHome(){
        resultSection.innerHTML = '';
        welcomeSection.style.display = 'block';
        searchInput.value = '';
        searchInput.focus();
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        // ë³€ê²½ëœ ë¶€ë¶„
        callApi('/api/new_examples', {})
            .then(updateExampleTags);
    }

    function updateExampleTags(response){
      renderInitialTags(response || {});
      if (currentLanguage !== 'ko') {
        translateTrendKeywords();
      }
    }

    function displayResult(res){
      if (!res || res.error || !res.summary) { 
        displayError(res ? { message: res.error || 'Invalid response from server.' } : { message: 'Empty response.' }); 
        return;
      }
      
      const insightsHtml = createInsightsHtml(res.insights || {});
      const deeperHtml = createDeeperDiveHtml(res);
      const cardClass = res.isSpecial ? 'result-card rainbow-background' : 'result-card';
      const cardStyle = !res.isSpecial && res.backgroundImageUrl ? `style="background-image:url('${escapeHtml(res.backgroundImageUrl)}');"` : '';
      
      const htmlContent = `
        <div class="${cardClass}" ${cardStyle}>
          <div class="card-content">
            <div class="summary-content">${escapeHtml(res.summary).replace(/\n/g,'<br>')}</div>
            ${insightsHtml}
            ${deeperHtml ? `<div class="divider"></div>${deeperHtml}` : ''}
          </div>
        </div>`;
      
      resultSection.innerHTML = htmlContent;
      resultSection.querySelectorAll('.question-item').forEach(el => {
        el.addEventListener('click', () => research(el.dataset.question));
      });
    }

    function createInsightsHtml(insights){
      const boxes = [
        createInsightBox(currentTranslations.keywordsLabel, insights.keywords),
        createInsightBox(currentTranslations.peopleLabel, insights.people),
        createInsightBox(currentTranslations.datesLabel, insights.dates)
      ].filter(Boolean);
      return boxes.length > 0 ? `<div class="insights-grid">${boxes.join('')}</div>` : '';
    }

    function createInsightBox(title, tags){
      if (!tags || tags.length === 0) return '';
      const tagsHtml = tags.map(t => `<div class="insight-tag" onclick="research('${escapeHtml(t)}')">${escapeHtml(t)}</div>`).join('');
      return `<div class="insight-box"><h4>${escapeHtml(title)}</h4><div class="insight-tags">${tagsHtml}</div></div>`;
    }

    function createDeeperDiveHtml(res){
      const detailsHtml = res.details ? `<h4 class="section-header">${currentTranslations.detailsHeader}</h4><div class="details-content">${escapeHtml(res.details).replace(/\n/g,'<br>')}</div>` : '';
      const questionsHtml = res.questions && res.questions.length ? `<h4 class="section-header">${currentTranslations.questionsHeader}</h4><div class="suggested-questions"><ul>${res.questions.map(q => `<li class="question-item" data-question="${escapeHtml(q)}">${escapeHtml(q)}</li>`).join('')}</ul></div>` : '';
      const linksHtml = res.links && res.links.length ? `<h4 class="section-header">${currentTranslations.linksHeader}</h4><div class="related-links"><ul>${res.links.map(link => `<li><a href="${escapeHtml(link.url)}" target="_blank" rel="noopener noreferrer"><span class="material-icons">open_in_new</span>${escapeHtml(link.title)}</a></li>`).join('')}</ul></div>` : '';
      return [detailsHtml, questionsHtml, linksHtml].filter(Boolean).join('<br><br>');
    }

    function research(query){
      if (!query || !query.trim()) return;
      searchInput.value = query;
      window.scrollTo({ top: 0, behavior: 'smooth' });
      performSearch();
    }

    function escapeHtml(unsafe){
      if (unsafe === null || unsafe === undefined) return '';
      return String(unsafe).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    function displayError(error){
      console.error("Error:", error);
      const msg = (error && (error.message || error.toString())) || 'An unknown error occurred.';
      resultSection.innerHTML = `<div class="result-card error-card"><div class="card-content"><h2>Error</h2><p>${escapeHtml(msg)}</p></div></div>`;
    }

   (async function init(){
      // 1. ë‹¤í¬ëª¨ë“œ/ì–¸ì–´ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
      try {
          if (localStorage.getItem('darkMode') === 'enabled') {
              document.body.classList.add('dark-mode');
              document.querySelector('#darkModeToggle .material-icons').textContent = 'light_mode';
          }
          
          const savedLang = localStorage.getItem('clatyLanguage');
          const savedFlag = localStorage.getItem('clatyLanguageFlag');
          const savedCode = localStorage.getItem('clatyLanguageCode');
          
          if (savedLang && translations[savedLang]) {
              selectLanguage(savedLang, savedFlag, savedCode); 
              // selectLanguage í•¨ìˆ˜ê°€ UIë‘ ë³€ìˆ˜ ë‹¤ ì„¸íŒ…í•´ì¤Œ
          }
      } catch(e){}
    
      // 2. ì„œë²„(Python)í•œí…Œ "ìš”ì¦˜ íŠ¸ë Œë“œ ë­ì•¼?" ë¬¼ì–´ë³´ê¸° (ì—¬ê¸°ê°€ í•µì‹¬!)
      try {
          // ë¡œë”© ì¤‘ í‘œì‹œ
          exampleTagsContainer.innerHTML = '<div style="opacity:0.5;">íŠ¸ë Œë“œ ë¶„ì„ ì¤‘...</div>';
          
          // API í˜¸ì¶œ (new_examples)
          const response = await callApi('/api/new_examples', {});
          
          // ê²°ê³¼ í™”ë©´ì— ë¿Œë¦¬ê¸°
          renderInitialTags(response);
      } catch(e) {
          console.log("ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", e);
          // ì‹¤íŒ¨í•˜ë©´ ê¸°ë³¸ê°’ì´ë¼ë„ ë³´ì—¬ì£¼ê¸°
          renderInitialTags({ issues: [] }); 
      }
    })();
</script>
</body>
</html>
